<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Women's Day</title>
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;0,700;1,600&family=Montserrat:wght@400;500;600&family=Caveat:wght@600;700&family=Dancing+Script:wght@600;700&display=swap"
        rel="stylesheet">
    <!-- Confetti & html2canvas -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-grad: linear-gradient(135deg, #fcd5ce 0%, #fef8fa 50%, #fdf0d5 100%);
            --env-color: #ffa8c5;
            --env-flap: #ffb8d1;
            --env-pocket: #ff8fae;
            --seal-red: #d90429;
            --text-dark: #3a3a3a;
            --pink-accent: #d85a7f;
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--bg-grad);
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            position: relative;
        }

        /* Particles / Bokeh */
        #bg-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            pointer-events: none;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% {
                transform: translateY(-10vh) translateX(0) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                transform: translateY(110vh) translateX(30px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Intro Screen (·∫¢nh 1.png & Ch·ªØ) */
        .intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--bg-color);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            /* X·∫øp ·∫£nh v√† ch·ªØ theo c·ªôt d·ªçc */
            justify-content: center;
            align-items: center;
            /* 
              K·ªãch b·∫£n th·ªùi gian m·ªõi:
              - 0s -> 2s: Hi·ªán ·∫£nh 1.png
              - 2s -> 4s: L·∫ßn l∆∞·ª£t hi·ªán t·ª´ng ch·ªØ
              - 4s -> 7s: ƒê·ª©ng y√™n ch·ªù 3s cho ng∆∞·ªùi xem ƒë·ªçc
              - 7s -> 7.8s: M·ªù d·∫ßn ƒëi (Fade-out to√†n b·ªô intro)
              => T·ªïng Intro = ~7.8s
            */
            animation: fadeOutIntro 0.8s ease-out forwards 7s;
            pointer-events: none;
        }

        .intro-screen img {
            width: 95vw;
            max-width: 800px;
            max-height: 55vh;
            /* Gi·∫£m b·ªõt ch√∫t chi·ªÅu cao ƒë·ªÉ nh∆∞·ªùng ch·ªó cho ch·ªØ */
            object-fit: contain;
            /* ·∫¢nh r√µ r·ªát l√™n v√† h∆°i zoom nh·∫π trong 2s ƒë·∫ßu */
            animation: zoomInIntro 2s ease-out forwards;
        }

        /* Ch·ªØ Welcome Intro */
        .intro-text-container {
            margin-top: 30px;
            text-align: center;
        }

        .intro-text-line {
            font-family: 'Playfair Display', serif;
            color: var(--pink-dark);
            font-size: 28px;
            font-weight: 700;
            opacity: 0;
            transform: translateY(20px);
            /* M·ªói d√≤ng s·∫Ω l·∫ßn l∆∞·ª£t tr∆∞·ª£t l√™n */
            animation: introTextReveal 1s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        /* CƒÉn th·ªùi gian cho t·ª´ng d√≤ng xu·∫•t hi·ªán (b·∫Øt ƒë·∫ßu sau khi ·∫£nh hi·ªán xong 2s) */
        .intro-text-line:nth-child(1) {
            animation-delay: 2s;
        }

        /* Happy */
        .intro-text-line:nth-child(2) {
            animation-delay: 2.5s;
            font-size: 34px;
            color: var(--pink-accent);
            margin: 5px 0;
        }

        /* International */
        .intro-text-line:nth-child(3) {
            animation-delay: 3s;
            font-size: 38px;
        }

        /* Women's Day */

        @keyframes introTextReveal {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes zoomInIntro {
            0% {
                transform: scale(0.9);
                opacity: 0;
            }

            100% {
                transform: scale(1.15);
                opacity: 1;
            }
        }

        @keyframes fadeOutIntro {
            0% {
                opacity: 1;
                visibility: visible;
            }

            100% {
                opacity: 0;
                visibility: hidden;
            }
        }

        /* Audio Control removed per user request */

        /* Scene Container */
        .scene {
            position: relative;
            width: 320px;
            height: 220px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            /* Hi·ªáu ·ª©ng m·ªü ƒë·∫ßu: r∆°i t·ª´ tr√™n xu·ªëng v√† n·∫£y nh·∫π */
            transform: translateY(-150vh);
            /* ƒê·ª£i 7.5s cho c·ª•m Intro (·∫¢nh + Ch·ªØ + Ch·ªù) bi·∫øn m·∫•t ho√†n to√†n r·ªìi m·ªõi b·∫Øt ƒë·∫ßu r∆°i */
            animation: bounceDrop 1.2s cubic-bezier(0.28, 0.84, 0.42, 1) forwards 7.5s;
        }

        @keyframes bounceDrop {
            0% {
                transform: translateY(-150vh);
            }

            60% {
                transform: translateY(25px);
                /* R∆°i l·ªë qua ƒë√≠ch m·ªôt ch√∫t t·∫°o ƒë√† n·∫£y */
            }

            80% {
                transform: translateY(-10px);
                /* N·∫£y ng∆∞·ª£c l√™n tr√™n nh·∫π */
            }

            100% {
                transform: translateY(0);
                /* N·∫±m y√™n tƒ©nh t·∫°i v·ªã tr√≠ ƒë√≠ch */
            }
        }

        /* Envelope Parts */
        .envelope-back,
        .envelope-pocket,
        .envelope-flap,
        .seal {
            position: absolute;
            transition: opacity 1s ease, transform 1s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .envelope-back {
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--env-color);
            border-radius: 8px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.08), inset 0 0 30px rgba(255, 184, 209, 0.4);
            /* B√≥ng m·ªãn v√† lan t·ªèa t·ª± nhi√™n, m√†u b√≥ng nh·∫°t ƒëi */
            z-index: 1;
        }

        .envelope-pocket {
            bottom: 0;
            left: 0;
            width: 100%;
            height: 140px;
            background: var(--env-pocket);
            border-radius: 0 0 8px 8px;
            clip-path: polygon(0 0, 50% 35px, 100% 0, 100% 100%, 0 100%);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            z-index: 3;
        }

        .envelope-flap {
            top: 0;
            left: 0;
            width: 100%;
            height: 130px;
            background: var(--env-flap);
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            transform-origin: top center;
            border-radius: 8px 8px 0 0;
            z-index: 4;
            /* Extra shadow effect using drop-shadow on SVGs or pseudo if needed */
        }

        /* The Card */
        .card {
            position: absolute;
            top: 50%;
            left: 50%;
            /* Thay v√¨ d√πng margin √¢m c·ª©ng nh·∫Øc, d√πng translate ƒë·ªÉ cƒÉn gi·ªØa card theo t·ªâ l·ªá % container */
            transform: translate(-50%, -50%) scale(0.42) translateY(30px);
            /* Z-index 2 gi√∫p l√° th∆∞ nh√©t ho√†n h·∫£o d∆∞·ªõi t√∫i phong b√¨ (z=3) v√† tr√™n l∆∞ng phong b√¨ (z=1) */
            z-index: 2;
            width: 320px;
            /* Thi·∫øt l·∫≠p chi·ªÅu cao t·ªëi thi·ªÉu 480px, khi ch·ªØ nhi·ªÅu s·∫Ω t·ª± ƒë·ªông co gi√£n ph√¨nh ra (auto) */
            min-height: 480px;
            height: auto;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(255, 255, 255, 0.7);
            padding: 40px 30px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* ·∫®n ho√†n to√†n l√° th∆∞ ban ƒë·∫ßu ƒë·ªÉ v·ªè phong b√¨ tr√¥ng ƒë√≥ng k√≠n */
            opacity: 0;
            visibility: hidden;
            transition: transform 1.2s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.3s ease, visibility 0s;
        }

        /* 4 G√≥c Tranh ·∫¢nh Trang Tr√≠ (Th·∫ª Th∆∞) */
        .corner-img {
            position: absolute;
            width: 75px;
            height: 75px;
            object-fit: contain;
            opacity: 0;
            z-index: 5;
            pointer-events: none;
            transition: opacity 1s ease 1s, transform 1s cubic-bezier(0.2, 0.8, 0.2, 1) 1s;
        }

        .img-tl {
            top: -10px;
            left: -10px;
            transform: scale(0.5);
        }

        .img-tr {
            top: -10px;
            right: -10px;
            transform: scale(0.5);
        }

        .img-bl {
            bottom: -10px;
            left: -10px;
            transform: scale(0.5);
        }

        .img-br {
            bottom: -10px;
            right: -10px;
            transform: scale(0.5);
        }

        .card.reveal .corner-img {
            opacity: 1;
        }

        .card.reveal .img-tl,
        .card.reveal .img-tr,
        .card.reveal .img-bl,
        .card.reveal .img-br {
            transform: scale(1);
        }

        /* Wax Seal */
        .seal {
            position: absolute;
            top: 50%;
            left: 50%;
            /* T·ªça ƒë·ªô t√¢m tuy·ªát ƒë·ªëi, xoay x·ªü ngay gi·ªØa giao ƒëi·ªÉm b·∫±ng translate -50% */
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 35% 35%, var(--seal-red), #93061c);
            border-radius: 50%;
            z-index: 6;
            /* Lu√¥n n·ªïi tr√™n c√πng, ƒë√® l√™n flap (4) v√† pocket (3) */
            display: flex;
            justify-content: center;
            /* CƒÉn gi·ªØa text theo chi·ªÅu ngang */
            align-items: center;
            /* CƒÉn gi·ªØa text theo chi·ªÅu d·ªçc */
            color: #ffe6e6;
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(217, 4, 41, 0.4);
            animation: pulse 1.8s infinite;
            cursor: pointer;
        }

        .seal::before {
            content: '';
            position: absolute;
            width: 46px;
            height: 46px;
            border: 1px dashed rgba(255, 255, 255, 0.3);
            border-radius: 50%;
        }

        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 4px 15px rgba(217, 4, 41, 0.4);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.1);
                box-shadow: 0 4px 25px rgba(217, 4, 41, 0.6);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 4px 15px rgba(217, 4, 41, 0.4);
            }
        }

        .instruction {
            position: absolute;
            bottom: -60px;
            /* H·∫° th·∫•p text xu·ªëng m·ªôt ch√∫t ƒë·ªÉ c√°ch ly r√µ r·ªát kh·ªèi phong b√¨ */
            left: 50%;
            /* B√≠ quy·∫øt d√πng Flex/Transform cƒÉn gi·ªØa tuy·ªát ƒë·ªëi theo khung scene */
            width: 100%;
            text-align: center;
            font-family: 'Playfair Display', serif;
            /* Font ch·ªØ x·ªãn x√≤ qu√Ω t·ªôc */
            font-size: 26px;
            /* Ch·ªØ to ra */
            font-style: italic;
            /* In nghi√™ng nh·∫π cho th√™m ph·∫ßn m·ªÅm m·∫°i */
            letter-spacing: 2px;
            font-weight: 700;
            color: var(--pink-dark);
            /* ƒê·ªïi m√†u cho sang */
            pointer-events: none;
            transition: opacity 0.5s ease;
            /* Ban ƒë·∫ßu ·∫©n ho√†n to√†n */
            opacity: 0;
            transform: translateX(-50%) translateY(10px);
            /* Chuy·ªÉn ƒë·ªông text fade-in k·∫øt h·ª£p v·ªõi blink. Text hi·ªán sau delay 8.7s (7.5s intro m·ªõi + 1.2s drop) */
            animation: instructionIntro 1s forwards 8.7s, blink 2s infinite 9.7s;
        }

        @keyframes instructionIntro {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(10px);
            }

            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
            }
        }

        /* Animation Classes */
        .envelope-flap.opened {
            transform: rotateX(180deg);
        }

        .env-fade {
            transform: translateY(120px) !important;
            opacity: 0 !important;
        }

        .envelope-flap.opened.env-fade {
            transform: rotateX(180deg) translateY(-120px) !important;
        }

        /* Card reveals */
        .card.slide-up {
            /* V·∫´n gi·ªØ l·∫°i t√¢m t·ªãnh ti·∫øn -50% c·ªßa translate g·ªëc tr∆∞·ªõc khi di chuy·ªÉn */
            transform: translate(-50%, -50%) scale(0.42) translateY(-400px);
            /* Hi·ªán l√° th∆∞ tr·ªü l·∫°i khi b·∫Øt ƒë·∫ßu tr∆∞·ª£t l√™n */
            opacity: 1;
            visibility: visible;
            /* clear the pocket */
        }

        .card.reveal {
            transform: translate(-50%, -50%) scale(1) translateY(-15px);
            /* Gi·ªØ nguy√™n tr·∫°ng th√°i hi·ªÉn th·ªã r√µ r√†ng */
            opacity: 1;
            visibility: visible;
            /* T·∫°o v·∫ßng h√†o quang ph√°t s√°ng l·∫•p l√°nh xung quanh thi·ªáp */
            animation: cardGlowPulse 2.5s infinite alternate ease-in-out;
            /* scaled and centered */
        }

        @keyframes cardGlowPulse {
            0% {
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1), 0 0 20px rgba(255, 184, 209, 0.3), inset 0 0 0 1px rgba(255, 255, 255, 0.7);
            }

            100% {
                box-shadow: 0 15px 45px rgba(216, 90, 127, 0.25), 0 0 60px rgba(255, 184, 209, 0.8), inset 0 0 0 1px rgba(255, 255, 255, 1);
            }
        }

        /* Card Internal Content Styles */
        .card-img {
            margin-bottom: 12px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 1s ease;
        }

        .card-title {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            color: var(--pink-accent);
            text-align: center;
            margin: 0 0 20px 0;
            line-height: 1.3;
            font-weight: 700;
            opacity: 0;
            transform: translateY(10px);
            transition: all 1s ease 0.2s;
        }

        .card-content-area {
            flex-grow: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .greeting {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 12px;
            min-height: 20px;
        }

        .message {
            font-size: 14.5px;
            color: #555;
            line-height: 1.6;
            text-align: justify;
        }

        .signature {
            font-family: 'Dancing Script', cursive;
            /* Thay font sang Dancing Script ƒë·ªÉ h·ªó tr·ª£ ti·∫øng Vi·ªát c√≥ d·∫•u */
            font-size: 40px;
            /* Ph√≥ng to m·ªôt ch√∫t ƒë·ªÉ r√µ n√©t */
            color: var(--pink-accent);
            align-self: flex-end;
            margin-top: auto;
            margin-top: 25px;
            opacity: 0;
            transform: translateY(5px);
            transition: all 1s ease;
        }

        .sub-signature {
            font-family: 'Dancing Script', cursive;
            /* Thay font sang Dancing Script ƒë·ªÉ h·ªó tr·ª£ ti·∫øng Vi·ªát c√≥ d·∫•u */
            font-size: 24px;
            color: #777;
            align-self: flex-end;
            margin-top: -5px;
            margin-right: 5px;
            opacity: 0;
            transform: translateY(5px);
            transition: all 1s ease;
        }

        .show-content {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }

        /* Save Button */
        .save-btn {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 28px;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: white;
            background: var(--pink-accent);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s ease;
            box-shadow: 0 6px 15px rgba(216, 90, 127, 0.35);
            z-index: 100;
        }

        .save-btn:hover {
            background: #c74a6e;
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 8px 20px rgba(216, 90, 127, 0.45);
        }

        /* Transition Classes cho Scene B -> C */
        .scene.fade-out {
            opacity: 0;
            transform: scale(0.9) translateY(-20px);
            transition: all 0.5s ease-out;
            pointer-events: none;
        }

        /* Giao Di·ªán C (Success Scene) */
        .success-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            /* N·∫±m d∆∞·ªõi ph√°o hoa nh∆∞ng tr√™n n·ªÅn */
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease-out;
            background: transparent !important;
            /* ƒê·∫£m b·∫£o khung ch·ª©a trong su·ªët 100% */
            box-shadow: none !important;
            border: none !important;
            outline: none !important;
        }

        .success-bg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100vw;
            max-width: 800px;
            /* Ph√≥ng th·∫≠t to ·∫£nh n·ªÅn */
            opacity: 0.25;
            /* H·∫° ƒë·ªô ƒë·∫≠m xu·ªëng v·ª´a ph·∫£i ƒë·ªÉ gi·ªëng n·ªÅn h∆°n */
            z-index: -1;
            /* √âp xu·ªëng d∆∞·ªõi ch·ªØ */
            pointer-events: none;
            mix-blend-mode: darken;
            /* Thu·∫≠t to√°n darken an to√†n h∆°n khi x√≥a n·ªÅn tr·∫Øng */
            animation: pulse 4s infinite ease-in-out;
            box-shadow: none !important;
            border: none !important;
        }

        /* G√≥c trang tr√≠ cho Giao di·ªán C */
        .success-corner {
            position: absolute;
            width: 99px;
            max-width: 25vw;
            height: auto;
            object-fit: contain;
            z-index: 10;
            pointer-events: none;
            opacity: 0.95;
            filter: drop-shadow(0px 4px 8px rgba(216, 90, 127, 0.3));
            animation: floatCorner 4s infinite ease-in-out;
        }

        .success-c-tl {
            top: -15px;
            left: -15px;
            transform-origin: top left;
        }

        .success-c-tr {
            top: -15px;
            right: -15px;
            transform-origin: top right;
            animation-delay: 1s;
        }

        .success-c-bl {
            bottom: -15px;
            left: -15px;
            transform-origin: bottom left;
            animation-delay: 2s;
        }

        .success-c-br {
            bottom: -15px;
            right: -15px;
            transform-origin: bottom right;
            animation-delay: 3s;
        }

        @keyframes floatCorner {

            0%,
            100% {
                transform: scale(1) translate(0, 0);
            }

            50% {
                transform: scale(1.05) translate(-2px, -2px);
            }
        }

        .success-scene.show {
            display: flex;
            /* Ph·∫£i delay t√≠ ƒë·ªÉ Flex render tr∆∞·ªõc khi thay ƒë·ªïi opacity */
        }

        .success-scene.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .success-text {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            color: var(--pink-dark);
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 2px 5px rgba(255, 255, 255, 0.8);
            line-height: 1.4;
        }

        .success-subtext {
            font-family: 'Montserrat', sans-serif;
            font-size: 16px;
            color: var(--pink-accent);
            font-weight: 700;
            text-align: center;
            max-width: 80%;
            line-height: 1.5;
        }

        /* Heart rain cho giao di·ªán C */
        .heart-rain {
            position: absolute;
            font-size: 24px;
            color: var(--pink-accent);
            animation: fall linear forwards;
            z-index: 45;
            opacity: 0.7;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }

        /* Mobile tweaks */
        @media (max-width: 360px) {
            .scene {
                transform: scale(0.9);
            }

            .card.reveal {
                transform: scale(0.95) translateY(-20px);
            }
        }
    </style>
</head>

<body>

    <!-- Intro Splash Screen -->
    <div class="intro-screen">
        <img src="1.png" alt="Happy Women's Day Intro">
        <div class="intro-text-container">
            <div class="intro-text-line">Happy</div>
            <div class="intro-text-line">International</div>
            <div class="intro-text-line">Women's Day</div>
        </div>
    </div>

    <!-- Audio Player -->
    <!-- ƒê√£ th√™m file intro.mp3 v√†o source ƒë·ªÉ thay th·∫ø nh·∫°c c≈©. B·ªè loop ƒë·ªÉ ch·ªâ ph√°t nh·∫°c ƒë√∫ng 1 l·∫ßn. C√≥ preload="auto" ƒë·ªÉ t·∫£i tr∆∞·ªõc ch·ªëng tr·ªÖ nh·∫°c khi host -->
    <audio id="bgMusic" preload="auto">
        <source src="intro.mp3" type="audio/mpeg">
        <!-- C√≥ d·ª± ph√≤ng file thay th·∫ø n·∫øu m·∫•t -->
        <source
            src="https://cdn.pixabay.com/download/audio/2022/05/16/audio_fcdb773d42.mp3?filename=piano-moment-9835.mp3"
            type="audio/mpeg">
    </audio>

    <!-- Falling Particles -->
    <div id="bg-particles"></div>

    <!-- Main Container -->
    <div class="scene" id="scene">

        <div class="envelope-back env-part"></div>

        <!-- The Main Glassmorphism Card -->
        <div class="card" id="card">
            <!-- 4 G√≥c ·∫¢nh Trang Tr√≠ -->
            <img src="tren trai.png" alt="Top Left Decor" class="corner-img img-tl">
            <img src="tren phai.png" alt="Top Right Decor" class="corner-img img-tr">
            <img src="duoi trai.png" alt="Bottom Left Decor" class="corner-img img-bl">
            <img src="duoi phai.png" alt="Bottom Right Decor" class="corner-img img-br">

            <div class="card-img" id="cardImg">
                <!-- Flower Image -->
                <img src="flower.png" alt="Flower Decoration"
                    style="width: 200px; height: 200px; object-fit: contain; filter: drop-shadow(0px 4px 8px rgba(216, 90, 127, 0.3));">
            </div>

            <h1 class="card-title" id="cardTitle">Happy International<br>Women's Day</h1>

            <div class="card-content-area">
                <div class="greeting" id="greeting"></div>
                <div class="message" id="messageText"></div>
                <div class="signature" id="signature">Tr.Th·ªãnh</div>
                <div class="sub-signature" id="subSignature">tr·ª£ gi·∫£ng ch·ªã ^^</div>
            </div>
        </div>

        <div class="envelope-pocket env-part"></div>
        <div class="envelope-flap env-part" id="flap"></div>
        <div class="seal env-part" id="seal">8/3</div>

        <div class="instruction" id="instruction">FOR YOU</div>
    </div>

    <button class="save-btn" id="saveBtn">L∆∞u gi·ªØ k·ª∑ ni·ªám</button>

    <!-- Success Scene (Giao di·ªán C) -->
    <div class="success-scene" id="successScene">
        <img src="end.png" alt="Background" class="success-bg">

        <!-- 4 G√≥c hoa l√° trang tr√≠ l·ªông l·∫´y -->
        <img src="goc tren trai-Photoroom.png" alt="Top Left" class="success-corner success-c-tl">
        <img src="goc tren phai-Photoroom.png" alt="Top Right" class="success-corner success-c-tr">
        <img src="goc duoi ben trai-Photoroom.png" alt="Bottom Left" class="success-corner success-c-bl">
        <img src="goc duoi ben phai-Photoroom.png" alt="Bottom Right" class="success-corner success-c-br">

        <div class="success-text">K·ª∑ ni·ªám ƒë√£ ƒë∆∞·ª£c l∆∞u gi·ªØ</div>
        <div class="success-subtext">G·ª≠i ng√†n l·ªùi ch√∫c th√°ng ba,<br>Ch√∫c ch·ªã r·∫°ng r·ª°, m·∫∑n m√† s·∫Øc xu√¢n!</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Generate elegant background particles (petals/bokeh dots)
            const particlesContainer = document.getElementById('bg-particles');
            for (let i = 0; i < 35; i++) {
                let petal = document.createElement('div');
                petal.classList.add('particle');
                petal.style.left = Math.random() * 100 + 'vw';
                petal.style.width = (Math.random() * 8 + 4) + 'px';
                petal.style.height = (Math.random() * 8 + 4) + 'px';
                petal.style.animationDuration = (Math.random() * 6 + 4) + 's';
                petal.style.animationDelay = (Math.random() * 4) + 's';

                // Mix of pastel pink petals and white bokeh
                if (Math.random() > 0.4) {
                    petal.style.background = 'linear-gradient(to bottom right, rgba(255,182,193,0.8), rgba(255,200,210,0.4))';
                    petal.style.borderRadius = '50% 0 50% 50%'; // Petal shape
                } else {
                    petal.style.background = 'rgba(255, 255, 255, 0.5)';
                    petal.style.borderRadius = '50%';
                    petal.style.boxShadow = '0 0 10px rgba(255,255,255,0.7)';
                }
                particlesContainer.appendChild(petal);
            }

            // 2. Personalize the Greeting via URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            let nameParam = urlParams.get('name');

            const escapeHTML = (str) => {
                let div = document.createElement('div'); div.innerText = str; return div.innerHTML;
            };

            let pronoun = "b·∫°n";
            let sender = "m√¨nh";
            let greetingName = "ng∆∞·ªùi ph·ª• n·ªØ tuy·ªát v·ªùi";

            if (nameParam && nameParam.trim() !== '') {
                greetingName = escapeHTML(nameParam.trim());
                let nameLower = greetingName.toLowerCase();

                // Smart pronoun detection
                if (nameLower.startsWith("ch·ªã") || nameLower.includes(" ch·ªã ")) { pronoun = "ch·ªã"; sender = "em"; }
                else if (nameLower.startsWith("em") || nameLower.includes(" em ")) { pronoun = "em"; sender = "anh"; }
                else if (nameLower.startsWith("c√¥") || nameLower.startsWith("d√¨") || nameLower.startsWith("b√°c")) {
                    pronoun = nameLower.split(' ')[0]; sender = "con";
                }
            }

            const greetingText = `G·ª≠i ch·ªã H·∫±ng xinh x·∫Øn,`;
            const mainMsg = `Nh√¢n ng√†y Qu·ªëc t·∫ø Ph·ª• n·ªØ, em ch√∫c ch·ªã lu√¥n gi·ªØ ƒë∆∞·ª£c s·ª± an nhi√™n trong t√¢m h·ªìn, n·ª• c∆∞·ªùi r·∫°ng r·ª° tr√™n m√¥i, c√¥ng vi·ªác th√¨ lu√¥n thu·∫≠n bu·ªìm xu√¥i gi√≥, deadline t·ª± t√†ng h√¨nh, s·∫øp lu√¥n m·ªâm c∆∞·ªùi v√† l∆∞∆°ng th∆∞·ªüng th√¨ tƒÉng v√®o v√®o nha. Mong ch·ªã c√≥ m·ªôt ng√†y 8/3 th·∫≠t tr·ªçn v·∫πn, nh·∫≠n qu√† m·ªèi tay v√† ng·∫≠p tr√†n ng∆∞·ªùi th√¢n y√™u ·∫°!`;

            // Typewriter effect function (H·ªó tr·ª£ in th·∫ª HTML)
            const typeWriter = async (element, text, speed) => {
                let currentHTML = '';
                let isTag = false;
                text = text.replace(/\n/g, '<br>');

                for (let i = 0; i < text.length; i++) {
                    let char = text.charAt(i);
                    currentHTML += char;

                    if (char === '<') isTag = true;
                    if (char === '>') isTag = false;

                    // Ph·∫£i ƒë·ª£i tag ƒë√≥ng xong m·ªõi update innerHTML v√† delay t·∫°o hi·ªáu ·ª©ng m∆∞·ª£t m√†
                    if (!isTag && char !== '<') {
                        element.innerHTML = currentHTML;
                        await new Promise(r => setTimeout(r, speed + Math.random() * 20));
                    }
                }
            };

            // Audio setup
            const audioObj = document.getElementById('bgMusic');

            // 3. Setup interaction and Storyboard Timeline
            const scene = document.getElementById('scene');
            const flap = document.getElementById('flap');
            const card = document.getElementById('card');
            const seal = document.getElementById('seal');
            const instruction = document.getElementById('instruction');
            let isOpened = false;

            scene.addEventListener('click', async () => {
                if (isOpened) return;
                isOpened = true;

                // Auto-play audio gracefully when user opens the card
                // Promise.catch handles the autoplay block policy from strict browsers when deployed
                audioObj.volume = 0.5; // ƒê·∫∑t √¢m l∆∞·ª£ng v·ª´a ph·∫£i d·ªÖ nghe
                audioObj.play().catch(err => {
                    console.log("Audio play blocked by browser policy:", err);
                });

                // Phase 2: Opening Moment
                seal.style.opacity = '0';
                instruction.style.opacity = '0';

                // Flap opens
                flap.classList.add('opened');

                await new Promise(r => setTimeout(r, 600));

                // Allow card to slide out by pushing flap backwards in z-index
                flap.style.zIndex = '1';
                card.classList.add('slide-up');

                await new Promise(r => setTimeout(r, 700));

                // Envelope drops away
                document.querySelectorAll('.env-part').forEach(el => el.classList.add('env-fade'));

                // Card scales to center
                card.classList.add('reveal');

                await new Promise(r => setTimeout(r, 900));

                // Phase 3: Message Appearance
                document.getElementById('cardImg').classList.add('show-content');
                document.getElementById('cardTitle').classList.add('show-content');

                // Ch·ªù l√¢u h∆°n ƒë·ªÉ kh·ªõp v·ªõi ƒëi·ªáp kh√∫c nh·∫°c intro
                await new Promise(r => setTimeout(r, 1200));

                // Vi·∫øt ch·ªØ T√™n ng∆∞·ªùi d√πng v·ªõi t·ªëc ƒë·ªô ch·∫≠m r·∫£i h∆°n (70ms m·ªói k√Ω t·ª±)
                await typeWriter(document.getElementById('greeting'), greetingText, 70);

                // Ngh·ªâ nh·ªãp m·ªôt ch√∫t
                await new Promise(r => setTimeout(r, 600));

                // Vi·∫øt ch·ªØ L·ªùi ch√∫c v·ªõi t·ªëc ƒë·ªô ch·∫≠m h∆°n (55ms m·ªói k√Ω t·ª±)
                await typeWriter(document.getElementById('messageText'), mainMsg, 55);

                await new Promise(r => setTimeout(r, 800));

                document.getElementById('signature').classList.add('show-content');
                document.getElementById('subSignature').classList.add('show-content');

                await new Promise(r => setTimeout(r, 600));

                // Phase 4: Final Touch
                fireConfetti();

                await new Promise(r => setTimeout(r, 500));

                document.getElementById('saveBtn').style.opacity = '1';
                document.getElementById('saveBtn').style.pointerEvents = 'auto';
            });

            // Confetti generator function
            function fireConfetti() {
                var duration = 3000;
                var animationEnd = Date.now() + duration;
                var defaults = { startVelocity: 25, spread: 360, ticks: 100, zIndex: 99 };

                function randomInRange(min, max) { return Math.random() * (max - min) + min; }

                var interval = setInterval(function () {
                    var timeLeft = animationEnd - Date.now();
                    if (timeLeft <= 0) return clearInterval(interval);
                    var particleCount = 40 * (timeLeft / duration);
                    confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                    confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
                }, 250);
            }

            // Create memory image
            document.getElementById('saveBtn').addEventListener('click', () => {
                // T·∫°m ·∫©n giao di·ªán kh√¥ng c·∫ßn thi·∫øt ƒë·ªÉ ch·ª•p ·∫£nh ƒë·∫πp
                document.getElementById('saveBtn').style.opacity = '0';

                html2canvas(card, {
                    backgroundColor: '#fef8fa', // Use a uniform light pink pastel bg
                    scale: 2,
                    logging: false,
                    useCORS: true
                }).then(canvas => {
                    let link = document.createElement('a');
                    link.download = 'Thiep-8-3-Ky-Niem.png';
                    link.href = canvas.toDataURL("image/png");
                    link.click();

                    // --- K·ªäCH B·∫¢N CHUY·ªÇN C·∫¢NH SAU KHI L∆ØU ·∫¢NH ---

                    // B∆∞·ªõc 1: Cho bi·∫øn m·∫•t n√∫t Save v√† L√° th∆∞ (Scene B)
                    let sceneEl = document.getElementById('scene');
                    let btn = document.getElementById('saveBtn');

                    btn.style.opacity = '0';
                    btn.style.pointerEvents = 'none'; // Kh√≥a n√∫t b·∫•m lu√¥n

                    sceneEl.classList.add('fade-out'); // Thu nh·ªè v√† m·ªù ƒëi

                    // ƒê·ª£i 0.5s cho l√° th∆∞ m·ªù h·∫≥n r·ªìi m·ªõi ·∫©n n√≥ ƒëi (display none) v√† G·ªçi Scene C ra
                    setTimeout(() => {
                        sceneEl.style.display = 'none';

                        // B∆∞·ªõc 2: K√©o M√†n C (Success Scene) l√™n
                        let successScene = document.getElementById('successScene');

                        // ƒê√® Flex v√†o tr∆∞·ªõc ƒë·ªÉ tr√¨nh duy·ªát chu·∫©n b·ªã box model
                        successScene.classList.add('show');

                        // D√πng requestAnimationFrame ho·∫∑c setTimeout l·ª° nh·ªãp ƒë·ªÉ browser nh·∫≠n CSS transition
                        setTimeout(() => {
                            successScene.classList.add('visible');

                            // T·∫°o hi·ªáu ·ª©ng m∆∞a tr√°i tim l√∫c m√†n C hi·ªán ra
                            startHeartRain();
                        }, 50);

                    }, 500);

                });
            });

            // H√†m t·∫°o m∆∞a tr√°i tim
            function startHeartRain() {
                const colors = ['#f472b6', '#fb7185', '#e879f9']; // B·∫£ng m√†u h·ªìng cute
                const container = document.body;

                let heartInterval = setInterval(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart-rain';
                    heart.innerHTML = 'üíñ'; // K√Ω t·ª± tim
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.top = '-20px';
                    // Random th·ªùi gian r·ª•ng t·ª´ 3-6s
                    const duration = Math.random() * 3 + 3;
                    heart.style.animationDuration = duration + 's';
                    // Random size
                    heart.style.fontSize = Math.floor(Math.random() * 20 + 15) + 'px';
                    // Random m√†u
                    heart.style.color = colors[Math.floor(Math.random() * colors.length)];

                    container.appendChild(heart);

                    // X√≥a tim r·ª•ng xong cho nh·∫π m√°y
                    setTimeout(() => {
                        heart.remove();
                    }, duration * 1000);

                }, 200); // 0.2s ƒë·∫ª 1 tr√°i tim

                // T·ª± ng∆∞ng m∆∞a tim sau 8 gi√¢y ƒë·ªÉ kh·ªèi ƒë∆° m√°y
                setTimeout(() => {
                    clearInterval(heartInterval);
                }, 8000);
            }

        });
    </script>
</body>

</html>